<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>用 JavaScript 写出一个彩票系统？ | TaroXin Blog</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/blog/favicon.ico">
    <meta name="description" content="泰罗凹凸曼文章集散地1">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    
    <link rel="preload" href="/blog/assets/css/1.styles.6c4638a4.css" as="style"><link rel="preload" href="/blog/assets/js/app.c3e4c659.js" as="script"><link rel="preload" href="/blog/assets/js/11.ebf2347a.js" as="script"><link rel="preload" href="/blog/assets/js/12.52e6032a.js" as="script"><link rel="preload" href="/blog/assets/js/15.bee57ac8.js" as="script">
    <link rel="stylesheet" href="/blog/assets/css/1.styles.6c4638a4.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu have-body-img"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><img src="/blog/assets/img/header.png" alt="TaroXin Blog" class="logo"> <span class="site-name can-hide">TaroXin Blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/" class="nav-link">泰罗GO</a></div><div class="nav-item"><a href="/blog/pages/2d6556/" class="nav-link">我的收藏</a></div><div class="nav-item"><a href="/blog/archives/" class="nav-link">所有文章</a></div> <a href="https://github.com/taroxin" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="https://source.taroxin.com/u-image-bed/header.png"> <div class="blogger-info"><h3>泰罗凹凸曼/TaroXin</h3> <span>凹凸曼界最会写代码的</span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/blog/" class="nav-link">泰罗GO</a></div><div class="nav-item"><a href="/blog/pages/2d6556/" class="nav-link">我的收藏</a></div><div class="nav-item"><a href="/blog/archives/" class="nav-link">所有文章</a></div> <a href="https://github.com/taroxin" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><a href="/blog/pages/7def50/" aria-current="page" class="active sidebar-link">用 JavaScript 写出一个彩票系统？</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/blog/pages/7def50/#杂谈" class="sidebar-link">杂谈</a></li><li class="sidebar-sub-header level2"><a href="/blog/pages/7def50/#彩票的规则" class="sidebar-link">彩票的规则</a></li><li class="sidebar-sub-header level2"><a href="/blog/pages/7def50/#数据量" class="sidebar-link">数据量</a></li><li class="sidebar-sub-header level2"><a href="/blog/pages/7def50/#更精妙的方法" class="sidebar-link">更精妙的方法</a></li><li class="sidebar-sub-header level2"><a href="/blog/pages/7def50/#完整的数据" class="sidebar-link">完整的数据</a></li><li class="sidebar-sub-header level2"><a href="/blog/pages/7def50/#随机来两注" class="sidebar-link">随机来两注</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/blog/pages/7def50/#什么时候进行分发" class="sidebar-link">什么时候进行分发</a></li><li class="sidebar-sub-header level3"><a href="/blog/pages/7def50/#数据回源如何做" class="sidebar-link">数据回源如何做</a></li><li class="sidebar-sub-header level3"><a href="/blog/pages/7def50/#数据交给彩票站的策略-避免数据被劫持" class="sidebar-link">数据交给彩票站的策略(避免数据被劫持)</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/blog/pages/7def50/#特意挑的两注" class="sidebar-link">特意挑的两注</a></li><li class="sidebar-sub-header level2"><a href="/blog/pages/7def50/#我要一等奖" class="sidebar-link">我要一等奖</a></li><li class="sidebar-sub-header level2"><a href="/blog/pages/7def50/#黄粱一梦" class="sidebar-link">黄粱一梦</a></li><li class="sidebar-sub-header level2"><a href="/blog/pages/7def50/#结语" class="sidebar-link">结语</a></li></ul></li><li><a href="/blog/pages/61abab/" class="sidebar-link">一文读懂 JavaScript 位运算，源码里的骚操作可能都是基于它实现的！</a></li><li><a href="/blog/pages/f93fae/" class="sidebar-link">尤大：不会说 Rap 的前端不是好前端！</a></li><li><a href="/blog/pages/4112aa/" class="sidebar-link">你不得不清楚的 Javascript 文件系统</a></li><li><a href="/blog/pages/1b3356/" class="sidebar-link">你需要更简洁的 Dialog 使用姿势！</a></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-06970110><div class="articleInfo" data-v-06970110><ul class="breadcrumbs" data-v-06970110><li data-v-06970110><a href="/blog/" title="首页" class="iconfont icon-home router-link-active" data-v-06970110></a></li> <li data-v-06970110><a href="/blog/categories/?category=JavaScript" title="分类" data-v-06970110>JavaScript</a></li></ul> <div class="info" data-v-06970110><div title="作者" class="author iconfont icon-touxiang" data-v-06970110><a href="https://github.com/taroxin" target="_blank" title="作者" class="beLink" data-v-06970110>TaroXin/泰罗凹凸曼</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-06970110><a href="javascript:;" data-v-06970110>2023-02-15</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABGpJREFUSA3tVVtoXFUU3fvOI53UlmCaKIFmwEhsE7QK0ipFEdHEKpXaZGrp15SINsXUWvBDpBgQRKi0+KKoFeJHfZA+ED9KKoIU2gYD9UejTW4rVIzm0VSTziPzuNu1z507dibTTjL4U/DAzLn3nL3X2o91ziX6f9wMFdh6Jvbm9nNSV0msViVO6tN1Rm7NMu2OpeJ9lWBUTDxrJbYTS0hInuwciu9eLHlFxCLCZEk3MegsJmZ5K/JD6t7FkFdEvGUo1g7qJoG3MHImqRIn8/nzY1K9UPKKiJmtnUqHVE3Gbuay6vJE/N2FEmuxFjW2nUuE0yQXRRxLiTUAzs36zhZvOXJPdX850EVnnLZkB8prodQoM5JGj7Xk2mvC7JB8tG04Ef5PiXtG0UtxupRQSfTnBoCy554x18yJHI6I+G5Eru4LHmPJZEQsrvPUbMiA8G/WgMK7w7I+ez7++o2ANfbrjvaOl1tFMs+htG3IrZH9/hDX1Pr8Tc0UvH8tcX29KzAgIGcEkINyW5BF9x891hw6VYqgJHEk0huccS7vh3C6gTiODL+26huuBtbct8eZnqLML8PkxGYpuPZBqtqwkSjgc4mB5gbgig5i+y0UDK35LMxXisn9xQtK+nd26gTIHsHe/oblK/b29fUmN/8Y+9jAQrnBp56m1LcDlDp9irKTExSKduXJVWSqdBMA08pEJnEIOB3FPPMybu/oeV8zFeYN3xx576Q6RH+VmplE4ncQV5v+5rzSoyOU7PuEAg8g803PwBJ0CExno/jcMbN8tONYeOmHiuUNryvm3fRUy4tMPVLdAGkUhNWuggGrJcXPv+ouCjz0MKUHz1J2/E8IC9nqTabcxgaBYM0hPhD5Y65FsbxRQKxCQrDjDctW7PUM3HuZunFyifSAqEfuzCp48Il24luWUWZoyJCaPR82jE0+kFA643wRFVni4RYSq3ohJO2pZ7B5dO4xkDWbEpossJPLSrPjYID8rS2UHTlvyNxqIGsg674XJJ7vnh5L7PNwC4hh2sjCI96mzszOTpxLF0T7l88Yz7lAuK6OnL8gXLOnTvpzSb22YG8W7us3jSebFHeeqnXRG1vt+MoUM84LQIBmMsCTAcOauTh0T0l0neQK7m2bLMt2mGxU3HYssS0J2cdv5wljlPsrIuZLAG/2DOZIXgCYT8uMGZN+e2kSirfxZOPCsC0f24nTZzspnVn9VePS1Z5vubmAGGXG8ZFno9Hel0yfA5ZPhF7Dh972BQJ2qCpgH67lmWtBYbvk6sz02wjky2vXyz0XErP/kFB619js1BtwfOV4OPRqOQBjy3Qbk18vigUPPSD5ceHnwck7W9bhAqZdd7SuG7w4/P2F/GaJh8c7e9qgow+Q7cGBo+98WsLkuktFqiZabtXuQTu/Y5ETbR0v7tNSFnvrmu6pjdoan2KjMu8q/Hmj1EfCO2ZGfEIbIXKUlw8qaX9/b2oeSJmFksSeT/Fn0V3nSypChh4Gjh74ybO9aeZ/AN2dwciu2/MhAAAAAElFTkSuQmCC">用 JavaScript 写出一个彩票系统？<!----></h1> <!----> <div class="theme-vdoing-content content__default"><p>原本这篇文章是打算叫「假如我是彩票系统开发者」，但细想一下，如果在文章中引用太多的 JavaScript 的话，反而不是那么纯粹，毕竟也只是我的一厢情愿，彩票开发也不全如本文所讲，有所误导的话便也是得不偿失了。</p> <p>所以索性就叫「用 JavaScript 写出一个彩票系统」，也算明朗了一些，声明一下，<strong>真实的彩票系统不是这么开发出来的，也不具备明面上的规律，我们应该相信彩票的公正性</strong>，尽管其可能不是基于随机！</p> <h2 id="杂谈"><a href="#杂谈" class="header-anchor">#</a> 杂谈</h2> <p>最近大抵是迷上彩票了，幻想着自己若能暴富，也可以带着家庭 &quot;鸡犬升天&quot; 了，不过事与愿违，我并没有冲天的气运，踏踏实实工作才是出路？</p> <p>买彩票的时候，我也考虑了很久，到底怎么样的号码可以在 1700 万注中脱颖而出，随机试过，精心挑选的也试过，找规律的模式也试过，甚至我还用到了爬虫去统计数据，啼笑人非！</p> <p>我们默认彩票系统是基于统计学来实现一等奖的开奖，那么历史以来的一等奖理所当然应该是当期统计率最低的一注，所以，最开始的时候我是这么想的：</p> <ol><li>获取历史以来所有的中奖彩票号码</li> <li>使用代码去统计出所有号码的中奖次数</li> <li>按照出现几率最低的数字来排序</li> <li>依次组成某几注新号码</li></ol> <p>天马行空，却也是自己发财欲望的一种发泄渠道罢了，称之为异想天开也不为过，扯了挺多，哈哈！</p> <p>上面的思路我已经实践过了，用了差不多一年的时间，没有用！别用！当然你也可以试试，如果你中了，恭喜，你才是天选之人！</p> <h2 id="彩票的规则"><a href="#彩票的规则" class="header-anchor">#</a> 彩票的规则</h2> <p>我们这里的彩票规则统一使用「双色球」的规则来说明，其购买的规则如下：</p> <ol><li>红球为六位，选项从 1 - 33 中挑选，不可重复</li> <li>蓝球为一位，选项从 1 - 16 中挑选</li> <li>红蓝双色球一共七位组成一注</li></ol> <p>一等奖一般中全部购买的注里面挑选一注，这一注可能被多个人买，也有可能是一个人买了该注的倍数。</p> <p>所以粗略统计，彩票的中奖几率计算公式如下所示：</p> <p>使用组合数公式来计算，从 <code>n</code>  个元素中取 <code>k</code>  个元素的的组合数公式为：</p> <mjx-container jax="SVG" display="true" class="MathJax" style="direction:ltr;display:block;text-align:center;margin:1em 0;"><svg xmlns="http://www.w3.org/2000/svg" width="19.919ex" height="5.451ex" role="img" focusable="false" viewBox="0 -1449.5 8804 2409.5" style="overflow:visible;min-height:1px;min-width:1px;vertical-align:-2.172ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D436" d="M50 252Q50 367 117 473T286 641T490 704Q580 704 633 653Q642 643 648 636T656 626L657 623Q660 623 684 649Q691 655 699 663T715 679T725 690L740 705H746Q760 705 760 698Q760 694 728 561Q692 422 692 421Q690 416 687 415T669 413H653Q647 419 647 422Q647 423 648 429T650 449T651 481Q651 552 619 605T510 659Q484 659 454 652T382 628T299 572T226 479Q194 422 175 346T156 222Q156 108 232 58Q280 24 350 24Q441 24 512 92T606 240Q610 253 612 255T628 257Q648 257 648 248Q648 243 647 239Q618 132 523 55T319 -22Q206 -22 128 53T50 252Z" style="stroke-width:3;"></path></g><g data-mml-node="mrow" transform="translate(760,0)"><g data-mml-node="TeXAtom" data-mjx-texclass="OPEN"><g data-mml-node="mo" transform="translate(0 -0.5)"><path data-c="28" d="M701 -940Q701 -943 695 -949H664Q662 -947 636 -922T591 -879T537 -818T475 -737T412 -636T350 -511T295 -362T250 -186T221 17T209 251Q209 962 573 1361Q596 1386 616 1405T649 1437T664 1450H695Q701 1444 701 1441Q701 1436 681 1415T629 1356T557 1261T476 1118T400 927T340 675T308 359Q306 321 306 250Q306 -139 400 -430T690 -924Q701 -936 701 -940Z" style="stroke-width:3;"></path></g></g><g data-mml-node="mfrac" transform="translate(736,0)"><g data-mml-node="mi" transform="translate(39.5,676)"><path data-c="1D458" d="M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z" style="stroke-width:3;"></path></g><g data-mml-node="mi" transform="translate(0,-686)"><path data-c="1D45B" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z" style="stroke-width:3;"></path></g></g><g data-mml-node="TeXAtom" data-mjx-texclass="CLOSE" transform="translate(1336,0)"><g data-mml-node="mo" transform="translate(0 -0.5)"><path data-c="29" d="M34 1438Q34 1446 37 1448T50 1450H56H71Q73 1448 99 1423T144 1380T198 1319T260 1238T323 1137T385 1013T440 864T485 688T514 485T526 251Q526 134 519 53Q472 -519 162 -860Q139 -885 119 -904T86 -936T71 -949H56Q43 -949 39 -947T34 -937Q88 -883 140 -813Q428 -430 428 251Q428 453 402 628T338 922T245 1146T145 1309T46 1425Q44 1427 42 1429T39 1433T36 1436L34 1438Z" style="stroke-width:3;"></path></g></g></g><g data-mml-node="mo" transform="translate(3109.8,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z" style="stroke-width:3;"></path></g><g data-mml-node="mfrac" transform="translate(4165.6,0)"><g data-mml-node="mrow" transform="translate(1880.2,676)"><g data-mml-node="mi"><path data-c="1D45B" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z" style="stroke-width:3;"></path></g><g data-mml-node="mo" transform="translate(600,0)"><path data-c="21" d="M78 661Q78 682 96 699T138 716T180 700T199 661Q199 654 179 432T158 206Q156 198 139 198Q121 198 119 206Q118 209 98 431T78 661ZM79 61Q79 89 97 105T141 121Q164 119 181 104T198 61Q198 31 181 16T139 1Q114 1 97 16T79 61Z" style="stroke-width:3;"></path></g></g><g data-mml-node="mrow" transform="translate(220,-710)"><g data-mml-node="mi"><path data-c="1D458" d="M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z" style="stroke-width:3;"></path></g><g data-mml-node="mo" transform="translate(521,0)"><path data-c="21" d="M78 661Q78 682 96 699T138 716T180 700T199 661Q199 654 179 432T158 206Q156 198 139 198Q121 198 119 206Q118 209 98 431T78 661ZM79 61Q79 89 97 105T141 121Q164 119 181 104T198 61Q198 31 181 16T139 1Q114 1 97 16T79 61Z" style="stroke-width:3;"></path></g><g data-mml-node="mo" transform="translate(799,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z" style="stroke-width:3;"></path></g><g data-mml-node="mi" transform="translate(1188,0)"><path data-c="1D45B" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z" style="stroke-width:3;"></path></g><g data-mml-node="mo" transform="translate(2010.2,0)"><path data-c="2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z" style="stroke-width:3;"></path></g><g data-mml-node="mi" transform="translate(3010.4,0)"><path data-c="1D458" d="M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z" style="stroke-width:3;"></path></g><g data-mml-node="mo" transform="translate(3531.4,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z" style="stroke-width:3;"></path></g><g data-mml-node="mo" transform="translate(3920.4,0)"><path data-c="21" d="M78 661Q78 682 96 699T138 716T180 700T199 661Q199 654 179 432T158 206Q156 198 139 198Q121 198 119 206Q118 209 98 431T78 661ZM79 61Q79 89 97 105T141 121Q164 119 181 104T198 61Q198 31 181 16T139 1Q114 1 97 16T79 61Z" style="stroke-width:3;"></path></g></g><rect width="4398.4" height="60" x="120" y="220"></rect></g></g></g></svg></mjx-container><p>根据公式，我们可以很容易的写出来一个简单的算法：</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">factorial</span><span class="token punctuation">(</span><span class="token parameter">n</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>n <span class="token operator">===</span> <span class="token number">0</span> <span class="token operator">||</span> n <span class="token operator">===</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token number">1</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> n <span class="token operator">*</span> <span class="token function">factorial</span><span class="token punctuation">(</span>n <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">combination</span><span class="token punctuation">(</span><span class="token parameter">n<span class="token punctuation">,</span> k</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">factorial</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span><span class="token function">factorial</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token function">factorial</span><span class="token punctuation">(</span>n <span class="token operator">-</span> k<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">combination</span><span class="token punctuation">(</span><span class="token number">33</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token function">combination</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 17721088</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>所以可以得出的结论是，双色球头奖的中奖几率为：</p> <mjx-container jax="SVG" display="true" class="MathJax" style="direction:ltr;display:block;text-align:center;margin:1em 0;"><svg xmlns="http://www.w3.org/2000/svg" width="10.045ex" height="4.638ex" role="img" focusable="false" viewBox="0 -1342 4440 2050" style="overflow:visible;min-height:1px;min-width:1px;vertical-align:-1.602ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mfrac"><g data-mml-node="mn" transform="translate(1970,676)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z" style="stroke-width:3;"></path></g><g data-mml-node="mn" transform="translate(220,-686)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z" style="stroke-width:3;"></path><path data-c="37" d="M55 458Q56 460 72 567L88 674Q88 676 108 676H128V672Q128 662 143 655T195 646T364 644H485V605L417 512Q408 500 387 472T360 435T339 403T319 367T305 330T292 284T284 230T278 162T275 80Q275 66 275 52T274 28V19Q270 2 255 -10T221 -22Q210 -22 200 -19T179 0T168 40Q168 198 265 368Q285 400 349 489L395 552H302Q128 552 119 546Q113 543 108 522T98 479L95 458V455H55V458Z" transform="translate(500,0)" style="stroke-width:3;"></path><path data-c="37" d="M55 458Q56 460 72 567L88 674Q88 676 108 676H128V672Q128 662 143 655T195 646T364 644H485V605L417 512Q408 500 387 472T360 435T339 403T319 367T305 330T292 284T284 230T278 162T275 80Q275 66 275 52T274 28V19Q270 2 255 -10T221 -22Q210 -22 200 -19T179 0T168 40Q168 198 265 368Q285 400 349 489L395 552H302Q128 552 119 546Q113 543 108 522T98 479L95 458V455H55V458Z" transform="translate(1000,0)" style="stroke-width:3;"></path><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z" transform="translate(1500,0)" style="stroke-width:3;"></path><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z" transform="translate(2000,0)" style="stroke-width:3;"></path><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z" transform="translate(2500,0)" style="stroke-width:3;"></path><path data-c="38" d="M70 417T70 494T124 618T248 666Q319 666 374 624T429 515Q429 485 418 459T392 417T361 389T335 371T324 363L338 354Q352 344 366 334T382 323Q457 264 457 174Q457 95 399 37T249 -22Q159 -22 101 29T43 155Q43 263 172 335L154 348Q133 361 127 368Q70 417 70 494ZM286 386L292 390Q298 394 301 396T311 403T323 413T334 425T345 438T355 454T364 471T369 491T371 513Q371 556 342 586T275 624Q268 625 242 625Q201 625 165 599T128 534Q128 511 141 492T167 463T217 431Q224 426 228 424L286 386ZM250 21Q308 21 350 55T392 137Q392 154 387 169T375 194T353 216T330 234T301 253T274 270Q260 279 244 289T218 306L210 311Q204 311 181 294T133 239T107 157Q107 98 150 60T250 21Z" transform="translate(3000,0)" style="stroke-width:3;"></path><path data-c="38" d="M70 417T70 494T124 618T248 666Q319 666 374 624T429 515Q429 485 418 459T392 417T361 389T335 371T324 363L338 354Q352 344 366 334T382 323Q457 264 457 174Q457 95 399 37T249 -22Q159 -22 101 29T43 155Q43 263 172 335L154 348Q133 361 127 368Q70 417 70 494ZM286 386L292 390Q298 394 301 396T311 403T323 413T334 425T345 438T355 454T364 471T369 491T371 513Q371 556 342 586T275 624Q268 625 242 625Q201 625 165 599T128 534Q128 511 141 492T167 463T217 431Q224 426 228 424L286 386ZM250 21Q308 21 350 55T392 137Q392 154 387 169T375 194T353 216T330 234T301 253T274 270Q260 279 244 289T218 306L210 311Q204 311 181 294T133 239T107 157Q107 98 150 60T250 21Z" transform="translate(3500,0)" style="stroke-width:3;"></path></g><rect width="4200" height="60" x="120" y="220"></rect></g></g></g></svg></mjx-container><h2 id="数据量"><a href="#数据量" class="header-anchor">#</a> 数据量</h2> <p>我们通过上面的算法得知了彩票的总注数为  <code>17721088</code> ，那么这么多注数字组成的数据到底有多大呢？</p> <p>简单计算下，一注彩票可以用 14 个数字来表示，如  <code>01020304050607</code> ，那么在操作系统中，这串数字的大小为  <code>14B</code> ，那么粗略可知的是，如果所有的彩票注数都在一个文件中，那么这个文件的大小为：</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> totalSize <span class="token operator">=</span> <span class="token number">17721088</span> <span class="token operator">*</span> <span class="token number">14</span> <span class="token operator">/</span> <span class="token number">1024</span> <span class="token operator">/</span> <span class="token number">1024</span> <span class="token comment">// 236.60205078125MB</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>很恐怖的数量，有没有可能更小？我们研究一下压缩算法！</p> <p><code>01</code>  这个数字在内存中的占用是两个字节，也就是 2B，那如果我们把  <code>01</code>  用小写  <code>a</code>  代替，那么其容量就可以变成 1B，总体容量可减少一半左右！</p> <p><img src="https://source.taroxin.com/u-image-bed/1678716702848.png" alt=""></p> <p>这样子的话，我们上面的一注特别牛的号码  <code>01020304050607</code>  就可以表示为  <code>abcdefg</code>  !</p> <p>这就是压缩算法最最最基本的原理，压缩算法有很多种，大体分为有损压缩和无损压缩，对于我们数据类的内容来讲，我们一般都会选择无损压缩！</p> <ul><li>有损压缩算法：这些算法能够在压缩数据时丢弃一些信息，但通常能在不影响实际使用的前提下实现更高的压缩比率，其中最常见的是图像、音频和视频压缩算法</li> <li>无损压缩算法：这些算法不会丢弃任何信息，它们通过查找输入数据中的重复模式，并使用更短的符号来表示它们来实现压缩。无损压缩算法常用于文本、代码、配置文件等类型的数据</li></ul> <p>首先，让我们先准备一些测试数据，我们使用下面这个简单的组合数生成算法来获取出 1000 个组合数：</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">generateCombinations</span><span class="token punctuation">(</span><span class="token parameter">arr<span class="token punctuation">,</span> len<span class="token punctuation">,</span> maxCount</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  
  <span class="token keyword">function</span> <span class="token function">generate</span><span class="token punctuation">(</span><span class="token parameter">current<span class="token punctuation">,</span> start</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 如果已经生成的组合数量达到了最大数量，则停止生成</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">.</span>length <span class="token operator">===</span> maxCount<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 如果当前已经生成的组合长度等于指定长度，则表示已经生成了一种组合</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>current<span class="token punctuation">.</span>length <span class="token operator">===</span> len<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      result<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>current<span class="token punctuation">)</span>
      <span class="token keyword">return</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> start<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> arr<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      current<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
      <span class="token function">generate</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token operator">...</span>current<span class="token punctuation">]</span><span class="token punctuation">,</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>
      current<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token function">generate</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> result
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><p>接下来，我们需要生成 1000 注双色球，红球是从 1 - 33 中取组合数，蓝球是从 1 - 16 中依次取数</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">getDoubleColorBall</span><span class="token punctuation">(</span><span class="token parameter">count</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 红球数组：['01', '02' .... '33']</span>
  <span class="token keyword">const</span> arrRed <span class="token operator">=</span> Array<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">length</span><span class="token operator">:</span> <span class="token number">33</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">_<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>index <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">padStart</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'0'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> arrRedResult <span class="token operator">=</span> <span class="token function">generateCombinations</span><span class="token punctuation">(</span>arrRed<span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> count<span class="token punctuation">)</span>

  <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token keyword">let</span> blue <span class="token operator">=</span> <span class="token number">1</span>
  arrRedResult<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">line</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    result<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>line<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span>blue<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">padStart</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'0'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>blue <span class="token operator">&gt;</span> <span class="token number">16</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      blue <span class="token operator">=</span> <span class="token number">1</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token keyword">return</span> result
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>我们将获取的彩票内容放在文件中以便于下一步操作：</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> firstPrize <span class="token operator">=</span> <span class="token function">getDoubleColorBall</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span>
fs<span class="token punctuation">.</span><span class="token function">writeFileSync</span><span class="token punctuation">(</span><span class="token string">'./hello.txt'</span><span class="token punctuation">,</span> firstPrize<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>这样子，我们就得到了第一版的文件，这是其文件大小：</p> <p><img src="https://source.taroxin.com/u-image-bed/1678723639832.png" alt=""></p> <p>试一下我们初步的压缩算法，我们将刚刚设定好的规则，也就是数字到字母的替换，用 JavaScript 实现出来，如下：</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">compressHello</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> letters <span class="token operator">=</span> <span class="token string">'abcdefghijklmnopqrstuvwxyzABCDEFG'</span>
  <span class="token keyword">const</span> doubleColorBallStr <span class="token operator">=</span> <span class="token function">getDoubleColorBall</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span>
  <span class="token keyword">let</span> resultStr <span class="token operator">=</span> <span class="token string">''</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> doubleColorBallStr<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">+=</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> number <span class="token operator">=</span> doubleColorBallStr<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">+</span> doubleColorBallStr<span class="token punctuation">[</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span>
    resultStr <span class="token operator">+=</span> letters<span class="token punctuation">[</span><span class="token function">parseInt</span><span class="token punctuation">(</span>number<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> resultStr
<span class="token punctuation">}</span>

<span class="token keyword">const</span> firstPrize <span class="token operator">=</span> <span class="token function">compressHello</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
fs<span class="token punctuation">.</span><span class="token function">writeFileSync</span><span class="token punctuation">(</span><span class="token string">'./hello-1.txt'</span><span class="token punctuation">,</span> firstPrize<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>这样我们就得到了一个全新的 hello 文件，他的大小如下所示，正好印证了我们的想法！</p> <p><img src="https://source.taroxin.com/u-image-bed/1678723704026.png" alt=""></p> <p>如果按照这个算法的方法，我们能将之前的文件压缩至一半大小，也就是  <code>118.301025390625MB</code> ，但是这就是极限了吗？不，上面我们讲过，这只是最基本的压缩，接下来，让我们试试更精妙的方法！</p> <h2 id="更精妙的方法"><a href="#更精妙的方法" class="header-anchor">#</a> 更精妙的方法</h2> <p>这里我们不对压缩算法的原理做过多的解释，如果诸位感兴趣的话，可以自己寻找类似的文章阅读，鉴于网上的文章质量参差不齐，我就不做推荐了！</p> <p>这里我们需要了解的是，我们正在研究的是一个彩票系统，所以他的数据压缩应该具备以下几个特征：</p> <ul><li>具备数据不丢失的特性，也就是无损压缩</li> <li>压缩率尽可能小，因为传输的文件可能非常大，如我们上面举的例子</li> <li>便于信息的传输，也就是支持 HTTP 请求</li></ul> <p>常做前端的同学应该知道，我们在 HTTP 请求头里面常见的一个参数  <code>content-encoding: gzip</code> ，在项目的优化方面，也会选择将资源文件转换为  <code>gzip</code>  来进行分发。在日常的使用中，我们也时常依赖  <code>Webpack</code> ， <code>Rollup</code>  等库，或者通过网络服务器如  <code>nginx</code>  来完成资源压缩， <code>gzip</code>  不仅可以使得发送的内容大大减少，而且客户端可以无损解压访问源文件。</p> <p>那么，我们能不能使用  <code>gzip</code>  来完成压缩呢？答案是可以， <code>Node.js</code>  为我们提供了  <code>zlib</code>  工具库，提供了相应的压缩函数：</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> zlib <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'zlib'</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> firstPrize <span class="token operator">=</span> <span class="token function">compressHello</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
fs<span class="token punctuation">.</span><span class="token function">writeFileSync</span><span class="token punctuation">(</span><span class="token string">'./hello-2.txt.gz'</span><span class="token punctuation">,</span> zlib<span class="token punctuation">.</span><span class="token function">gzipSync</span><span class="token punctuation">(</span>firstPrize<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>得到的结果是：<br> <img src="https://source.taroxin.com/u-image-bed/1678807704942.png" alt=""></p> <p>我们完成了 14KB -&gt; 3KB 的压缩过程！是不是很有意思？不过还是那句话，有没有可能更小？当然可以！</p> <p><code>content-encoding</code>  响应头一般是服务器针对返回的资源响应编码格式的设置信息，常见的值有以下三种：</p> <ul><li><code>gzip</code>  所有浏览器都支持的通用压缩格式</li> <li><code>brotli</code>  比  <code>gzip</code>  压缩性能更好，压缩率更小的一个新的压缩格式，老版本浏览器不支持</li> <li><code>deflate</code>  出于某些原因，使用不是很广泛，后有基于该算法的  <code>zlib</code>  压缩格式，不过也使用度不高</li></ul> <p>浏览器支持的压缩格式不只是这些，不过我们列举出的是较为常用的，我们尝试使用一下这三种压缩格式：</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> firstPrize <span class="token operator">=</span> <span class="token function">compressHello</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
fs<span class="token punctuation">.</span><span class="token function">writeFileSync</span><span class="token punctuation">(</span><span class="token string">'./hello-2.txt.gz'</span><span class="token punctuation">,</span> zlib<span class="token punctuation">.</span><span class="token function">gzipSync</span><span class="token punctuation">(</span>firstPrize<span class="token punctuation">)</span><span class="token punctuation">)</span>
fs<span class="token punctuation">.</span><span class="token function">writeFileSync</span><span class="token punctuation">(</span><span class="token string">'./hello-2.txt.def'</span><span class="token punctuation">,</span> zlib<span class="token punctuation">.</span><span class="token function">deflateSync</span><span class="token punctuation">(</span>firstPrize<span class="token punctuation">)</span><span class="token punctuation">)</span>
fs<span class="token punctuation">.</span><span class="token function">writeFileSync</span><span class="token punctuation">(</span><span class="token string">'./hello-2.txt.br'</span><span class="token punctuation">,</span> zlib<span class="token punctuation">.</span><span class="token function">brotliCompressSync</span><span class="token punctuation">(</span>firstPrize<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>我们可以看到， <code>deflate</code>  和  <code>gzip</code>  的压缩率不相上下，令人惊喜的是， <code>brotli</code>  的压缩竟然达到了惊人的 1KB ! 这不就是我们想要的吗？</p> <p><img src="https://source.taroxin.com/u-image-bed/1678812002467.png" alt=""></p> <p>还可能更小吗？哈哈哈哈，当然，如果不考虑 HTTP 支持，我们完全可以使用如  <code>7-zip</code>  等压缩率更低的压缩算法去完成压缩，然后使用客户端做手动解压。不过点到为止，更重要的工作我们还没有做！</p> <p>在这之前，我们需要先了解一下解压过程，如果解压后反而数据丢失，那就得不偿失了！</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 执行解压操作</span>
<span class="token keyword">const</span> brFile <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span><span class="token string">'./hello-2.txt.br'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> gzipFile <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span><span class="token string">'./hello-2.txt.gz'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> deflateFile <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span><span class="token string">'./hello-2.txt.def'</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> brFileStr <span class="token operator">=</span> zlib<span class="token punctuation">.</span><span class="token function">brotliDecompressSync</span><span class="token punctuation">(</span>brFile<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> gzipFileStr <span class="token operator">=</span> zlib<span class="token punctuation">.</span><span class="token function">gunzipSync</span><span class="token punctuation">(</span>gzipFile<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> deflateFileStr <span class="token operator">=</span> zlib<span class="token punctuation">.</span><span class="token function">inflateSync</span><span class="token punctuation">(</span>deflateFile<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>brFileStr<span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>gzipFileStr<span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>deflateFileStr<span class="token punctuation">)</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>brFileStr <span class="token operator">===</span> gzipFileStr<span class="token punctuation">,</span> brFileStr <span class="token operator">===</span> deflateFileStr<span class="token punctuation">)</span> <span class="token comment">// true, true</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>如上，我们知晓尽管压缩算法的效果很惊人，但是其解压后的数据依然是无损的！</p> <h2 id="完整的数据"><a href="#完整的数据" class="header-anchor">#</a> 完整的数据</h2> <p>让我们构建出完整的 17721088 注数据测试一下完整的压缩算法的能力如何？这里我们使用  <code>brotli</code>  和  <code>gzip</code>  算法分别进行压缩测试！</p> <p>首先，应该修改我们生成数据的函数，如下：</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">generateAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> arrRed <span class="token operator">=</span> Array<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">length</span><span class="token operator">:</span> <span class="token number">33</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">_<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>index <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">padStart</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'0'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> arrRedResult <span class="token operator">=</span> <span class="token function">generateCombinations</span><span class="token punctuation">(</span>arrRed<span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> Number<span class="token punctuation">.</span><span class="token constant">MAX_VALUE</span><span class="token punctuation">)</span>

  <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  arrRedResult<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">line</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">16</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      result<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>line<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span> <span class="token operator">+</span> i<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">padStart</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'0'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token keyword">return</span> result
<span class="token punctuation">}</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">generateAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token comment">// 17721088</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>接下来我们要经过初步压缩并将其写入文件中：</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">compressAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> letters <span class="token operator">=</span> <span class="token string">'abcdefghijklmnopqrstuvwxyzABCDEFG'</span>
  <span class="token keyword">const</span> allStr <span class="token operator">=</span> <span class="token function">generateAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span>
  <span class="token keyword">let</span> resultStr <span class="token operator">=</span> <span class="token string">''</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> allStr<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">+=</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> number <span class="token operator">=</span> allStr<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">+</span> allStr<span class="token punctuation">[</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span>
    resultStr <span class="token operator">+=</span> letters<span class="token punctuation">[</span><span class="token function">parseInt</span><span class="token punctuation">(</span>number<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> resultStr
<span class="token punctuation">}</span>

<span class="token keyword">const</span> firstPrize <span class="token operator">=</span> <span class="token function">compressAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
fs<span class="token punctuation">.</span><span class="token function">writeFileSync</span><span class="token punctuation">(</span><span class="token string">'./all-ball.txt'</span><span class="token punctuation">,</span> firstPrize<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p><img src="https://source.taroxin.com/u-image-bed/1678813717783.png" alt=""></p> <p>正如我们预料的，经过初步压缩之后，文件大小达到了大约 118MB，但是其实际占用 124MB，是属于计算机存储的范畴，我们现在不在本篇文章中讨论，感兴趣的同学可以自己查一查，根据字节数计算，其大小为：</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> totalSize <span class="token operator">=</span> <span class="token number">124047616</span> <span class="token operator">/</span> <span class="token number">1024</span> <span class="token operator">/</span> <span class="token number">1024</span> <span class="token comment">// 118.30102539 MB</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>目前来看是符合预期的，我们来看看两个压缩算法的真本事！</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> firstPrize <span class="token operator">=</span> <span class="token function">compressAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
fs<span class="token punctuation">.</span><span class="token function">writeFileSync</span><span class="token punctuation">(</span><span class="token string">'./all-ball.txt.gz'</span><span class="token punctuation">,</span> zlib<span class="token punctuation">.</span><span class="token function">gzipSync</span><span class="token punctuation">(</span>firstPrize<span class="token punctuation">)</span><span class="token punctuation">)</span>
fs<span class="token punctuation">.</span><span class="token function">writeFileSync</span><span class="token punctuation">(</span><span class="token string">'./all-ball.txt.br'</span><span class="token punctuation">,</span> zlib<span class="token punctuation">.</span><span class="token function">brotliCompressSync</span><span class="token punctuation">(</span>firstPrize<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><img src="https://source.taroxin.com/u-image-bed/1678814436883.png" alt=""></p> <p>其实是很震惊的一件事情，尽管我对  <code>brotli</code>  的期待足够高，也不会想到他能压缩到仅仅 4M 大小，不过对于我们来说，这是一件幸事，对于之后的分发操作有巨大的优势！</p> <h2 id="随机来两注"><a href="#随机来两注" class="header-anchor">#</a> 随机来两注</h2> <p>从彩票站购买彩票的时候，随机来两注的行为是非常常见的，但是当你尝试随机号码的时候，会发生什么呢？</p> <p>我们先从彩票数据的分发讲起，首先彩票数据的分发安全性和稳定性的设计肯定是毋庸置疑的，但是这不是我们目前需要考虑的问题，目前我们应该解决的是，如果才能更低程度的控制成本！</p> <p>假设设计这套系统的人是你，如果控制随机号码的中奖率？我的答案是，从已有的号码池里面进行选择！</p> <p>如果让每个彩票站获取到其对应的号码池，答：数据分发！如果采用数据分发的模式的话，需要考虑的问题如下：</p> <ul><li>什么时候进行分发</li> <li>数据回源如何做</li> <li>如何避免所有数据被劫持</li> <li>数据交给彩票站的策略</li></ul> <p>据 2021 年公开信息，彩票站的数量已经达到 20 万家（未查证，无参考价值），我们假设目前的彩票站数量为 30 万家！</p> <h3 id="什么时候进行分发"><a href="#什么时候进行分发" class="header-anchor">#</a> 什么时候进行分发</h3> <p>我们知道的是，彩票的购买截止时间是在晚上八点，开奖时间是在晚上的九点十五，在晚上八点之后，我们只能购买到下一期的彩票，那么这个节点应该从晚上的八点开始，计划是这样子的：</p> <ol><li>从目前已有的彩票库里面，按照号码出现几率从高到低排列</li> <li>挑选出前 50 万注分发给 30 万彩票站，这个时间彩票站的数据都是统一的</li> <li>每个小时同步一次数据，同步的是其他彩票站 &quot;特意挑选的数据&quot;</li></ol> <p>50 万注的数据量有多大？试试看：</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">getFirstSend</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> letters <span class="token operator">=</span> <span class="token string">'abcdefghijklmnopqrstuvwxyzABCDEFG'</span>
  <span class="token keyword">const</span> doubleColorBallStr <span class="token operator">=</span> <span class="token function">getDoubleColorBall</span><span class="token punctuation">(</span><span class="token number">500000</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span>
  <span class="token keyword">let</span> resultStr <span class="token operator">=</span> <span class="token string">''</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> doubleColorBallStr<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">+=</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> number <span class="token operator">=</span> doubleColorBallStr<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">+</span> doubleColorBallStr<span class="token punctuation">[</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span>
    resultStr <span class="token operator">+=</span> letters<span class="token punctuation">[</span><span class="token function">parseInt</span><span class="token punctuation">(</span>number<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> resultStr
<span class="token punctuation">}</span>

<span class="token keyword">const</span> firstPrize <span class="token operator">=</span> <span class="token function">getFirstSend</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
fs<span class="token punctuation">.</span><span class="token function">writeFileSync</span><span class="token punctuation">(</span><span class="token string">'./first-send.txt.br'</span><span class="token punctuation">,</span> zlib<span class="token punctuation">.</span><span class="token function">brotliCompressSync</span><span class="token punctuation">(</span>firstPrize<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p><img src="https://source.taroxin.com/u-image-bed/1678982965179.png" alt=""></p> <p>仅一张图片的大小，获取这些数据解压同步到彩票机时间不足 1s!</p> <p>解压示例如下：</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">decodeData</span><span class="token punctuation">(</span><span class="token parameter">brFile</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token keyword">const</span> content <span class="token operator">=</span> zlib<span class="token punctuation">.</span><span class="token function">brotliDecompressSync</span><span class="token punctuation">(</span>brFile<span class="token punctuation">)</span>
  <span class="token comment">// 按照七位每注的结构拆分</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> content<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">+=</span> <span class="token number">7</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    result<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>content<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> i <span class="token operator">+</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> result
<span class="token punctuation">}</span>

<span class="token keyword">const</span> firstSend <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span><span class="token string">'./first-send.txt.br'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> firstDataList <span class="token operator">=</span> <span class="token function">decodeData</span><span class="token punctuation">(</span>firstSend<span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>firstDataList<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token comment">// 500000</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>如何将获取到的字符形式的彩票转换为数字，如  <code>abcdefga</code>  转换为  <code>['01', '02', '03', '04', '05', '06, '01']</code> ：</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">letterToCode</span><span class="token punctuation">(</span><span class="token parameter">letterStr</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token keyword">const</span> letters <span class="token operator">=</span> <span class="token string">'abcdefghijklmnopqrstuvwxyzABCDEFG'</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> letterStr<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    result<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">(</span>letters<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>letterStr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">padStart</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'0'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> result
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>至于分发？我们可以参考一下市面上已有的一些概念做一下对比，下面是笼统的一个网络服务器的 TPS 预估值，也就是说彩票服务器在 1 秒内可以处理的最大请求数：</p> <ul><li>低性能：TPS 在 50 以下，适用于低流量的应用场景，例如个人博客、小型企业网站等。</li> <li>中性能：TPS 在 50~500 之间，适用于一般的网站和应用场景，例如中小型电商网站、社交网络等。</li> <li>高性能：TPS 在 500~5000 之间，适用于高流量的网站和应用场景，例如大型电商网站、游戏网站等。</li> <li>超高性能：TPS 在 5000 以上，适用于超高流量的网站和应用场景，例如互联网巨头的网站、在线游戏等。</li></ul> <p>按照这种模式的话，50 万彩票站的数据同步在 100 秒内就可以完成，当然，诸位，这里是单机模式，如果做一个彩票服务的话，单机肯定是不可能的，想要提高 TPS，那就做服务器集群，如果有 100 台服务器集群的话，处理这些请求仅仅需要 1 秒！（任性吗？有钱当然可以任性！）（这些数据的得出都是基于理论，不提供参考价值）</p> <h3 id="数据回源如何做"><a href="#数据回源如何做" class="header-anchor">#</a> 数据回源如何做</h3> <p>非常简单！我们需要获取的数据是哪一些呢？没有经过随机算法，直接被购买的彩票数据！也就是我们经常听到的 &quot;守号&quot; 的那些老彩民！</p> <p>同样，根据媒体查询得知（不做参考），彩票站的客流量是每小时 1 至 10 人，经营时间，早上九点至晚上九点，最大客流量预计为 100 人每天！</p> <p>那么所有彩票站的总体客流量在 100 * 500000 = 50000000，大约为五千万人次，大约有 50% 是属于 &quot;守号&quot; 人，这里面可能还需要排除掉彩票站中已知的号码，不过在这里我们先不处理，先做全部的预估，那么</p> <p>服务器需要承载的最大 TPS 为：</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 服务器集群数量</span>
<span class="token keyword">const</span> machineCount <span class="token operator">=</span> <span class="token number">100</span>
<span class="token comment">// 总访问量，50%中的号码才会上报</span>
<span class="token keyword">const</span> totalVisit <span class="token operator">=</span> <span class="token number">50000000</span> <span class="token operator">*</span> <span class="token number">0.5</span> <span class="token comment">// 25000000</span>
<span class="token comment">// 总的时间，因为我们计算的是 10个小时的时间，所以应该计算的总秒数为 36000 秒！</span>
<span class="token keyword">const</span> totalSeconds <span class="token operator">=</span> <span class="token number">10</span> <span class="token operator">*</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">60</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>totalVisit <span class="token operator">/</span> totalSeconds <span class="token operator">/</span> machineCount<span class="token punctuation">)</span> <span class="token comment">// 6.944444444444445</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p><strong>TPS 仅为 7</strong>！！这还是没有排除掉已经知悉的号码的情况，具体的上报逻辑，参考下图：</p> <p><img src="https://source.taroxin.com/u-image-bed/1679454845426.png" alt=""></p> <h3 id="数据交给彩票站的策略-避免数据被劫持"><a href="#数据交给彩票站的策略-避免数据被劫持" class="header-anchor">#</a> 数据交给彩票站的策略 (避免数据被劫持)</h3> <p>所有的彩票数据当然不能全部都交给彩票站，我们需要对所有的数据做一个分层，其他彩票站 &quot;特意挑选的数据&quot; 就是我们要分层分发的数据！这样子也就能解决 <strong>&quot;如何避免所有数据被劫持&quot;</strong> 的问题！</p> <p>那么我们如何对数据进行分层呢？</p> <p>简而言之，就是我们将陕西西安彩票站的购票信息同步给山西太原，将上海市购票信息同步给江苏苏州！当然这里面需要考虑的点非常多，不仅仅是两地数据的交换，逻辑也比较复杂，通常需要考虑的点是：</p> <ul><li>数据同步难度，跨地区同步对服务器压力巨大，如华南向华北同步</li> <li>数据相似程度，两地的数据如果历史以来相似度区别很大，反而不能达到覆盖的目的，因为我们最终是想要这注号码被购买更多次</li> <li>数据同步时差，如新疆等地，鉴于网络问题，比其他地要慢很多的情况，这样就会漏号，那么就应该把这些地方的数据同步到更繁华的区域，如上海市，但是这一点看似是和第一二点相悖的</li></ul> <p>就说这么多，说的多了其实我也不懂。或者说还没想出来，如果有这方面比较厉害的大佬，可以提供思路！我们先看看随机的号码结果如何：</p> <p>我们来尝试随机获取你需要的两注：</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">random</span><span class="token punctuation">(</span><span class="token parameter">count</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> count<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> index <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> firstDataList<span class="token punctuation">.</span>length<span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>firstDataList<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">)</span>
    result<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token function">letterToCode</span><span class="token punctuation">(</span>firstDataList<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> result
<span class="token punctuation">}</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p><img src="https://source.taroxin.com/u-image-bed/1678984191614.png" alt=""></p> <p>OK，你觉得可以中奖吗？哈哈哈，还是有可能的，继续往下看吧！</p> <h2 id="特意挑的两注"><a href="#特意挑的两注" class="header-anchor">#</a> 特意挑的两注</h2> <p>我是一个典型的 &quot;守号&quot; 人，每天都拿着自己算出来的几注号码，去购买彩票，那么我可以中奖吗？（目前没中）</p> <p>根据上面的描述，我们应该知道，&quot;守号&quot; 人购买的号码需要判断系统是否存在数据，如果存在的话，就不会触发上报，如果数据不存在，则会上报系统，由系统将当前号码分发给相邻市或数据近似的城市，预期当前号码可以被更多的人所购买，一注号码如果被购买的越多，其中奖的概率也就越低！</p> <p>不过特意挑选是要比随机挑选的中奖概率要大，但是也大不到哪里去。</p> <h2 id="我要一等奖"><a href="#我要一等奖" class="header-anchor">#</a> 我要一等奖</h2> <p>彩票的一等奖是基于统计的，即使彩票中心存在空号，也需要考虑空号所产生的二等奖至六等奖的数量，这是一个非常庞大的数据量，也是需要计算非常多的时间的，那么我们如何模拟呢？</p> <p>我们取 50 万注彩票，模拟一下这些彩票被购买的情况，可能会产生空号，可能会重复购买，或者购买多注等，尝试一下计算出我们需要付出的总金额！</p> <p>彩票中中奖规则是这样子的，浮动奖项我们暂时不考虑，给一等奖和二等奖都赋予固定的金额：</p> <ol><li>6 + 1 一等奖 奖金 500 万</li> <li>6 + 0 二等奖 奖金 30 万</li> <li>5 + 1 三等奖 奖金 3000 元</li> <li>5 + 0 或 4 + 1 四等奖 奖金 200 元</li> <li>4 + 0 或 3 + 1 五等奖 奖金 10 元</li> <li>2 + 1 或 1 + 1 或 0 + 1 都是 六等奖 奖金 5 元</li></ol> <p>根据这个规则，我们可以先写出对奖的函数：</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">/**
 * @param {String[]} target ['01', '02', '03', '04', '05', '06', '07']
 * @param {String[]} origin ['01', '02', '03', '04', '05', '06', '07']
 * @returns {Number} 返回当前彩票的中奖金额
 */</span>
<span class="token keyword">function</span> <span class="token function">compareToMoney</span><span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span> origin</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> money <span class="token operator">=</span> <span class="token number">0</span>
  <span class="token keyword">let</span> rightMatched <span class="token operator">=</span> target<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span> <span class="token operator">===</span> origin<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span>
  <span class="token comment">// 求左边六位的交集数量</span>
  <span class="token keyword">let</span> leftMatchCount <span class="token operator">=</span> target<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>
    <span class="token parameter">c</span> <span class="token operator">=&gt;</span> origin<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">.</span>length

  <span class="token keyword">if</span> <span class="token punctuation">(</span>leftMatchCount <span class="token operator">===</span> <span class="token number">6</span> <span class="token operator">&amp;&amp;</span> rightMatched<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    money <span class="token operator">+=</span> <span class="token number">5000000</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>leftMatchCount <span class="token operator">===</span> <span class="token number">6</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>rightMatched<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    money <span class="token operator">+=</span> <span class="token number">300000</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>leftMatchCount <span class="token operator">===</span> <span class="token number">5</span> <span class="token operator">&amp;&amp;</span> rightMatched<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    money <span class="token operator">+=</span> <span class="token number">3000</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>leftMatchCount <span class="token operator">===</span> <span class="token number">5</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>rightMatched<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    money <span class="token operator">+=</span> <span class="token number">200</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>leftMatchCount <span class="token operator">===</span> <span class="token number">4</span> <span class="token operator">&amp;&amp;</span> rightMatched<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    money <span class="token operator">+=</span> <span class="token number">200</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>leftMatchCount <span class="token operator">===</span> <span class="token number">4</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>rightMatched<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    money <span class="token operator">+=</span> <span class="token number">10</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>leftMatchCount <span class="token operator">===</span> <span class="token number">3</span> <span class="token operator">&amp;&amp;</span> rightMatched<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    money <span class="token operator">+=</span> <span class="token number">10</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>leftMatchCount <span class="token operator">===</span> <span class="token number">2</span> <span class="token operator">&amp;&amp;</span> rightMatched<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    money <span class="token operator">+=</span> <span class="token number">5</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>leftMatchCount <span class="token operator">===</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> rightMatched<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    money <span class="token operator">+=</span> <span class="token number">5</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>rightMatched<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    money <span class="token operator">+=</span> <span class="token number">5</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> money
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br></div></div><p>那么，应该如何得到利益最大化，步骤应该是这样子：</p> <ul><li>随机生成一组中奖号码</li> <li>对于每个购买的数字，检查是否与中奖号码匹配，并计算它的奖金金额</li> <li>对于所有购买的数字的奖金金额进行求和</li> <li>重复这个过程，直到找到最优的中奖号码</li></ul> <p>随机这个中奖号码非常重要，他决定着我们计算出整体数据的速度，所以我们按照下面的步骤进行获取：</p> <ul><li>将所有的号码按照购买数量进行排序（其实这里真实的场景应该联合考虑中奖号码的分布趋势才更精确）</li> <li>从空号开始查询，依次进行计算</li></ul> <p>先模拟出我们的购买数据：</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">getRandomCode</span><span class="token punctuation">(</span><span class="token parameter">count <span class="token operator">=</span> <span class="token number">500000</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> arrRed <span class="token operator">=</span> Array<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">length</span><span class="token operator">:</span> <span class="token number">33</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">_<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>index <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">padStart</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'0'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token comment">// generateCombinations 是我们上面定义过的函数</span>
  <span class="token keyword">const</span> arrRedResult <span class="token operator">=</span> <span class="token function">generateCombinations</span><span class="token punctuation">(</span>arrRed<span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> count<span class="token punctuation">)</span>

  <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token keyword">let</span> blue <span class="token operator">=</span> <span class="token number">1</span>
  arrRedResult<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">line</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    result<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token operator">...</span>line<span class="token punctuation">,</span> <span class="token punctuation">(</span>blue<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">padStart</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'0'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>blue <span class="token operator">&gt;</span> <span class="token number">16</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      blue <span class="token operator">=</span> <span class="token number">1</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token keyword">return</span> result
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">randomPurchase</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> codes <span class="token operator">=</span> <span class="token function">getRandomCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> code <span class="token keyword">of</span> codes<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> count <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">50</span><span class="token punctuation">)</span>
    result<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      code<span class="token punctuation">,</span>
      count<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> result
<span class="token punctuation">}</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">randomPurchase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><p>我们将得到类似于下面的数据结构，这对于统计来说较为方便：</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">code</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token string">'01'</span><span class="token punctuation">,</span> <span class="token string">'02'</span><span class="token punctuation">,</span>
      <span class="token string">'03'</span><span class="token punctuation">,</span> <span class="token string">'04'</span><span class="token punctuation">,</span>
      <span class="token string">'05'</span><span class="token punctuation">,</span> <span class="token string">'10'</span><span class="token punctuation">,</span>
      <span class="token string">'05'</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token literal-property property">count</span><span class="token operator">:</span> <span class="token number">17</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">code</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token string">'01'</span><span class="token punctuation">,</span> <span class="token string">'02'</span><span class="token punctuation">,</span>
      <span class="token string">'03'</span><span class="token punctuation">,</span> <span class="token string">'04'</span><span class="token punctuation">,</span>
      <span class="token string">'05'</span><span class="token punctuation">,</span> <span class="token string">'11'</span><span class="token punctuation">,</span>
      <span class="token string">'06'</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token literal-property property">count</span><span class="token operator">:</span> <span class="token number">4</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p>接下来，就是很简单的统计了，逻辑很简单，但对于数据量极为庞大的彩票来说，需要的时间！</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 空号在前，购买数量越多越靠后</span>
<span class="token keyword">const</span> purchaseList <span class="token operator">=</span> <span class="token function">randomPurchase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> a<span class="token punctuation">.</span>count <span class="token operator">-</span> b<span class="token punctuation">.</span>count<span class="token punctuation">)</span>
<span class="token keyword">const</span> bonusPool <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> purchaseList<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 假设这就是一等奖，那么就需要计算其价值</span>
  <span class="token keyword">const</span> firstPrize <span class="token operator">=</span> purchaseList<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
  <span class="token keyword">let</span> totalMoney <span class="token operator">=</span> <span class="token number">0</span>

  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> purchaseList<span class="token punctuation">.</span>length<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 与一等奖进行对比，对比规则是参照彩票中奖规则</span>
    <span class="token keyword">const</span> money <span class="token operator">=</span> <span class="token function">compareToMoney</span><span class="token punctuation">(</span>purchaseList<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">.</span>code<span class="token punctuation">,</span> firstPrize<span class="token punctuation">.</span>code<span class="token punctuation">)</span> <span class="token operator">*</span> purchaseList<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">.</span>count
    totalMoney <span class="token operator">+=</span> money
  <span class="token punctuation">}</span>

  bonusPool<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">code</span><span class="token operator">:</span> firstPrize<span class="token punctuation">.</span>code<span class="token punctuation">,</span>
    totalMoney<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> result <span class="token operator">=</span> bonusPool<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> a<span class="token punctuation">.</span>totalMoney <span class="token operator">-</span> b<span class="token punctuation">.</span>totalMoney<span class="token punctuation">)</span>
<span class="token comment">// 至于怎么挑，那就随心所欲了</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>code<span class="token punctuation">,</span> result<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>totalMoney<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><p>至于最后的一等奖怎么挑，那就随心所欲了，不过上面的算法在我的 M1 芯片计算需要的时间也将近 10 分钟，如果有更强大的机器，更厉害的算法，这个时长同样可以缩短，不展开了，累了，就这样吧！</p> <h2 id="黄粱一梦"><a href="#黄粱一梦" class="header-anchor">#</a> 黄粱一梦</h2> <p>终归是黄粱一梦，最终还是要回归生活，好好工作！不过谁知道呢，等会再买一注如何？</p> <p>彩票系统纯属臆测，不可能有雷同！</p> <h2 id="结语"><a href="#结语" class="header-anchor">#</a> 结语</h2> <p>我是泰罗凹凸曼，M78 星云最爱写代码的，我们下一篇再会！</p> <p><strong>去探索，不知道的东西还多着呢！</strong></p></div></div> <!----> <div class="page-edit"><!----> <div class="tags"><a href="/blog/tags/?tag=JavaScript" title="标签">#JavaScript</a><a href="/blog/tags/?tag=%E6%9D%82%E8%B0%88" title="标签">#杂谈</a></div> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">3/22/2023, 9:21:19 PM</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><!----> <a href="/blog/pages/61abab/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">一文读懂 JavaScript 位运算，源码里的骚操作可能都是基于它实现的！</div></a></div> <div class="page-nav"><p class="inner"><!----> <span class="next"><a href="/blog/pages/61abab/">一文读懂 JavaScript 位运算，源码里的骚操作可能都是基于它实现的！</a>→
      </span></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/blog/archives" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/blog/pages/1b3356/"><div>
            你需要更简洁的 Dialog 使用姿势！
            <!----></div></a> <span class="date">03-22</span></dt></dl><dl><dd>02</dd> <dt><a href="/blog/pages/4112aa/"><div>
            你不得不清楚的 Javascript 文件系统
            <!----></div></a> <span class="date">03-22</span></dt></dl><dl><dd>03</dd> <dt><a href="/blog/pages/f93fae/"><div>
            尤大：不会说 Rap 的前端不是好前端！
            <!----></div></a> <span class="date">03-18</span></dt></dl> <dl><dd></dd> <dt><a href="/blog/archives" class="more">更多文章&gt;</a></dt></dl></div></div></main></div> <div class="footer"><div class="icons"><a href="https://github.com/taroxin" title="GitHub" target="_blank" class="iconfont icon-github"></a><a href="https://juejin.cn/user/4459274890904632/posts" title="掘金" target="_blank" class="iconfont icon-juejin"></a><a href="https://space.bilibili.com/21371785" title="哔哩哔哩" target="_blank" class="iconfont icon-bilibili"></a><a href="mailto:15029352778@163.com" title="发邮件" target="_blank" class="iconfont icon-youjian"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2023-2023
    <span>
      <a href='http://taroxin.com' target='_blank'>TaroXin/泰罗凹凸曼</a>
    </span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <div class="body-bg" style="background:url() center center / cover no-repeat;opacity:0.5;"></div> <!----> <!----></div><div class="global-ui"><div></div></div></div>
    <script src="/blog/assets/js/app.c3e4c659.js" defer></script><script src="/blog/assets/js/11.ebf2347a.js" defer></script><script src="/blog/assets/js/12.52e6032a.js" defer></script><script src="/blog/assets/js/15.bee57ac8.js" defer></script>
  </body>
</html>
